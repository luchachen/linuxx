From aae817342794405c2f5c13767c675063c7a48880 Mon Sep 17 00:00:00 2001
From: qiyinhao <1014708050@qq.com>
Date: Tue, 1 Jun 2021 09:58:32 +0000
Subject: [PATCH 12/12] add pagecache mechanism

---
 run_pagecache_test.sh | 25 +++++++++++++++++++++++++
 1 file changed, 25 insertions(+)
 create mode 100755 run_pagecache_test.sh

diff --git a/run_pagecache_test.sh b/run_pagecache_test.sh
new file mode 100755
index 000000000..927e4e6f3
--- /dev/null
+++ b/run_pagecache_test.sh
@@ -0,0 +1,25 @@
+#!/bin/bash
+cd /sys/fs/cgroup/
+if [ ! -d "test" ]; then
+    mkdir test
+fi
+
+echo '+memory +io' >cgroup.subtree_control
+
+# 将当前shell pid 写入 cgroup.procs
+# 之后 fork 的子进程会自动加入 procs
+echo $$ >test/cgroup.procs
+
+# 控制pagecache 上限 - 1G
+echo 1073741824 >test/memory.pagecache_limit
+
+# 控制io 上限制 为 2M/S
+# echo '8:0 wbps=2097152' >test/io.max
+
+# 控制io 为 50K/s
+echo '8:0 wbps=51200 rbps=51200' >test/io.max
+
+cd -
+# ./test
+# dd if=/dev/zero of=io_pagecache_test bs=1M count=500
+taskset -c 4,5 ./gen_big_file_whlie.sh
\ No newline at end of file
-- 
2.44.0

